# StockTracker 项目蓝图



## 📋 项目概述

**项目名称:** StockTracker - 智能股票投资组合追踪系统

**项目定位:** 为个人投资者提供专业的股票投资组合管理、追踪和分析工具

**核心价值:**
- 帮助投资者清晰管理多个投资组合
- 实时追踪持仓收益和风险
- 提供数据驱动的投资决策支持
- 通过回测验证投资策略

## ✅ 需求澄清（2026-02-09）

以下内容基于与项目发起人的确认，用于作为后续设计与实施的约束：

- 目标：以股票回测为核心，支持个股与股票组合，优先中国与美国股票；基金/期货等资产后续再扩展。
- 数据：
  - 中国市场：优先 AKShare，要求分钟级实时（至少分钟级），支持本地存储与历史回填。
  - 美股市场：暂不要求盘中实时；需要每日收盘后更新最新分钟级数据。
  - 数据源预算：≤ 300 RMB/月。
  - 数据源接口需可插拔，支持更换数据源并全量回填数据库。
- 回测：
  - 回测内核优先自研，策略脚本以 Python 为主，可保存与复用。
  - Agent 负责将自然语言需求转为策略脚本，并可生成回测任务运行。
- 复盘与建议：
  - 记录历史回测结果与日志。
  - Agent 提供定性 + 定量建议，输出下一版参数与策略版本。
- 知识库：
  - 支持 PDF / TXT / JSON 资料入库，Agent 结合资料与回测数据进行建议与调参。
- 合规：
  - 当前以个人研究为主，暂不要求交易所授权数据；对外展示时再评估合规数据源。

## 🎯 总目标



**构建一个稳定、可靠、易用的股票投资组合管理系统**



### 核心指标



1. **稳定性**

   - 系统无崩溃运行

   - 进程管理可靠

   - 配置自动验证

   - 错误可追溯



2. **可靠性**

   - 数据持久化

   - API响应稳定

   - 事务一致性

   - 容错机制



3. **易用性**

   - 界面直观清晰

   - 操作流程简单

   - 错误提示明确

   - 文档完善



4. **功能完整性**

   - 投资组合管理

   - 持仓追踪

   - 实时行情获取

   - 收益分析

   - 策略回测



## 🏗️ 系统架构



### 技术栈



**前端:**

- React 18.2 - UI框架

- Vite 7.2 - 构建工具

- React Router 6 - 路由管理

- Axios - HTTP客户端

- Zustand - 状态管理

- Tailwind CSS - 样式框架

- Recharts - 数据可视化

- Lucide React - 图标库



**后端:**

- FastAPI - Web框架

- SQLAlchemy 2.0 - ORM

- Uvicorn - ASGI服务器

- SQLite - 数据库

- yfinance - 股票数据

- akshare - 中国股市数据

- backtrader - 回测引擎



**DevOps:**

- psutil - 进程管理

- Python脚本 - 服务器管理

- Node.js脚本 - 前端验证



### 系统分层



```

┌─────────────────────────────────────┐

│     前端应用层 (React + Vite)        │

│  - 用户界面                          │

│  - 状态管理                          │

│  - 路由控制                          │

└──────────────┬──────────────────────┘

               │ HTTP/REST API

┌──────────────▼──────────────────────┐

│     后端服务层 (FastAPI)             │

│  - RESTful API                      │

│  - 业务逻辑                          │

│  - 数据验证                          │

└──────────────┬──────────────────────┘

               │ SQLAlchemy ORM

┌──────────────▼──────────────────────┐

│     数据持久层 (SQLite)              │

│  - 投资组合                          │

│  - 持仓记录                          │

│  - 交易历史                          │

└─────────────────────────────────────┘



┌─────────────────────────────────────┐

│     外部数据源                        │

│  - yfinance (美股)                   │

│  - akshare (A股)                     │

│  - tushare (备用)                    │

└─────────────────────────────────────┘

```



## 🎯 核心功能模块



### 模块1: 投资组合管理

**目标:** 管理多个投资组合的生命周期



**功能点:**

- 创建投资组合(名称、初始资金、描述)

- 查看组合列表(总价值、收益率、状态)

- 编辑组合信息

- 删除组合(软删除)

- 激活/禁用组合



**业务规则:**

- 组合名称不能重复

- 初始资金必须大于0

- 删除组合需要确认

- 禁用组合不影响历史数据



### 模块2: 持仓管理

**目标:** 追踪投资组合中的股票持仓



**功能点:**

- 买入股票(股票代码、数量、价格)

- 卖出股票(数量、价格)

- 查看持仓列表(当前价格、成本、收益)

- 持仓详情(交易历史、收益曲线)

- 计算持仓收益率



**业务规则:**

- 股票代码必须有效

- 买入数量和价格必须大于0

- 卖出数量不能超过持仓

- 自动更新组合现金余额

- 计算平均成本



### 模块3: 实时行情

**目标:** 获取和显示股票实时价格



**功能点:**

- 获取股票当前价格

- 获取股票基本信息(名称、市值、PE等)

- 缓存行情数据(减少API调用)

- 批量获取多只股票行情

- 行情数据刷新



**业务规则:**

- 缓存有效期5分钟

- 失败时使用历史价格

- 区分A股和美股数据源

- 限制API调用频率



### 模块4: 收益分析

**目标:** 分析投资组合和持仓的收益表现



**功能点:**

- 组合总收益计算

- 单只股票收益计算

- 收益率对比

- 持仓占比分析

- 收益趋势图表



**业务规则:**

- 收益 = 当前市值 - 总成本

- 收益率 = 收益 / 总成本 × 100%

- 包含已实现和未实现收益

- 考虑现金余额



### 模块5: 策略回测

**目标:** 验证投资策略的历史表现



**功能点:**

- 定义回测策略

- 设置回测参数(起止日期、初始资金)

- 执行回测

- 查看回测结果(收益、回撤、夏普比率)

- 对比多个策略



**业务规则:**

- 使用历史数据

- 考虑交易成本

- 支持多种策略类型

- 结果可视化



### 模块6: AI助手

**目标:** 提供智能投资建议和分析



**功能点:**

- 投资建议生成

- 市场分析总结

- 风险提示

- 问答交互



**业务规则:**

- 使用OpenAI API

- 基于真实数据

- 仅供参考,非投资建议

- 记录对话历史



## 🔧 基础设施



### 进程管理系统

**目标:** 确保服务器进程可靠运行



**功能:**

- 端口占用检测

- PID文件锁定

- 僵尸进程清理

- 优雅关闭

- 强制重启



**实现:**

- `start_server.py` - 启动管理

- `stop_server.py` - 停止脚本

- 批处理脚本封装



### 配置验证系统

**目标:** 防止配置错误导致的问题



**功能:**

- 启动前配置检查

- 运行时配置验证

- API客户端验证

- 增强错误提示

- 独立验证工具



**实现:**

- `preflight.js` - 启动前检查

- `config.js` - 中心化配置

- `check-config.bat` - 验证工具



## 📊 数据模型



### Portfolio (投资组合)

```python

- id: int (主键)

- name: str (组合名称)

- description: str (描述)

- initial_capital: float (初始资金)

- cash_balance: float (现金余额)

- is_active: bool (是否激活)

- created_at: datetime

- updated_at: datetime

```



### Holding (持仓)

```python

- id: int (主键)

- portfolio_id: int (外键)

- symbol: str (股票代码)

- quantity: float (持仓数量)

- average_cost: float (平均成本)

- current_price: float (当前价格)

- market_value: float (市值)

```



### Transaction (交易记录)

```python

- id: int (主键)

- portfolio_id: int (外键)

- symbol: str (股票代码)

- transaction_type: str (买入/卖出)

- quantity: float (数量)

- price: float (价格)

- commission: float (手续费)

- timestamp: datetime

```



### Strategy (策略)

```python

- id: int (主键)

- name: str (策略名称)

- description: str (描述)

- parameters: json (策略参数)

- created_at: datetime

```



## 🎨 用户界面



### 页面结构



1. **首页 (Home)**

   - 投资组合概览

   - 总资产

   - 总收益

   - 快速操作



2. **组合管理 (Portfolios)**

   - 组合列表

   - 创建组合

   - 编辑组合

   - 删除组合



3. **持仓详情 (Portfolio Detail)**

   - 持仓列表

   - 买入/卖出操作

   - 收益分析

   - 交易历史



4. **交易记录 (Transactions)**

   - 交易历史列表

   - 筛选和搜索

   - 导出功能



5. **回测分析 (Backtest)**

   - 策略列表

   - 创建策略

   - 执行回测

   - 结果分析



6. **AI助手 (AI Assistant)**

   - 对话界面

   - 历史记录

   - 投资建议



## 🚀 部署架构



### 开发环境

- 本地开发

- 前端: localhost:5173-5177

- 后端: localhost:8001

- 数据库: SQLite文件



### 测试环境

- Docker容器

- 前端: Nginx

- 后端: Uvicorn

- 数据库: SQLite/PostgreSQL



### 生产环境

- 云服务器部署

- 前端: CDN + Nginx

- 后端: Uvicorn + Supervisor

- 数据库: PostgreSQL

- 反向代理: Nginx

- HTTPS: Let's Encrypt



## 📈 性能指标



### 响应时间

- API响应: < 200ms (P95)

- 页面加载: < 2s (首次)

- 页面切换: < 500ms



### 并发支持

- 同时用户: 100+

- API QPS: 1000+

- 数据库连接池: 20



### 数据规模

- 投资组合: 10,000+

- 持仓记录: 100,000+

- 交易记录: 1,000,000+



## 🔐 安全设计



### 认证授权

- JWT Token认证

- 密码加密存储(bcrypt)

- Token过期机制

- 权限控制



### 数据安全

- SQL注入防护

- XSS防护

- CSRF防护

- 敏感数据加密



### API安全

- 速率限制

- CORS配置

- HTTPS强制

- API密钥管理



## 📚 文档体系



### 用户文档

- 快速开始指南

- 功能使用教程

- 常见问题FAQ

- 最佳实践



### 开发文档

- 架构设计文档

- API接口文档

- 数据库设计文档

- 代码规范



### 运维文档

- 部署指南

- 配置说明

- 监控告警

- 故障排查



## 🎯 成功标准



### 功能完整性

- ✅ 所有核心功能可用

- ✅ 边界条件处理完善

- ✅ 错误处理健全

- ✅ 用户体验流畅



### 稳定性

- ✅ 无内存泄漏

- ✅ 无数据丢失

- ✅ 进程自动恢复

- ✅ 配置自动验证



### 性能

- ✅ 响应时间达标

- ✅ 并发支持达标

- ✅ 资源占用合理

- ✅ 可扩展性良好



### 可维护性

- ✅ 代码结构清晰

- ✅ 文档完善

- ✅ 测试覆盖充分

- ✅ 日志完整



## 🌟 项目愿景



**短期目标 (1-3个月):**

- 完成核心功能开发

- 实现基本的投资组合管理

- 接入实时行情数据

- 提供简单的收益分析



**中期目标 (3-6个月):**

- 完善回测功能

- 集成AI助手

- 优化用户体验

- 支持更多市场



**长期目标 (6-12个月):**

- 构建用户社区

- 提供高级分析工具

- 支持算法交易

- 移动端应用



## 📊 项目里程碑



### Milestone 1: 基础设施 ✅

- 前后端框架搭建

- 数据库设计

- 进程管理系统

- 配置验证系统



### Milestone 2: 核心功能

- 投资组合CRUD

- 持仓管理

- 实时行情

- 基础分析



### Milestone 3: 高级功能

- 策略回测

- AI助手集成

- 数据可视化

- 导入导出



### Milestone 4: 优化完善

- 性能优化

- 用户体验优化

- 测试覆盖

- 文档完善



### Milestone 5: 部署上线

- 容器化

- CI/CD

- 监控告警

- 用户反馈


---

**最后更新:** 2026-02-09
**版本:** 1.0
**状态:** 进行中
