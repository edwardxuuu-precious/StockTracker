# P1 ä»»åŠ¡å®Œæˆæ€»ç»“ï¼šå»ºç«‹ AI Benchmark åŸºç¡€è®¾æ–½

**æ‰§è¡Œæ—¶é—´**: 2026-02-10 15:11
**ä»»åŠ¡ä¼˜å…ˆçº§**: P1
**çŠ¶æ€**: âœ… æ ¸å¿ƒå®Œæˆï¼ˆKB benchmark runner å»¶åï¼‰

---

## 1. ä»»åŠ¡ç›®æ ‡

å»ºç«‹ Agent å’Œ KB çš„é•¿æœŸè´¨é‡ç›‘æ§èƒ½åŠ›ï¼Œé€šè¿‡ benchmark æµ‹è¯•é›†å’Œè‡ªåŠ¨åŒ–è¿è¡Œè„šæœ¬å®ç°è´¨é‡åº¦é‡ä¸è¿½è¸ªã€‚

## 2. äº¤ä»˜æˆæœ

### 2.1 æµ‹è¯•æ•°æ®é›†

#### Agent Prompt æµ‹è¯•é›†
**æ–‡ä»¶**: [backend/benchmarks/agent_prompt_test_set.py](../../backend/benchmarks/agent_prompt_test_set.py)

**è§„æ¨¡**: 20 ä¸ªæµ‹è¯•ç”¨ä¾‹

**è¦†ç›–èŒƒå›´**:
| ç±»åˆ« | ç”¨ä¾‹æ•° | ç¤ºä¾‹ |
|-----|--------|------|
| åŸºç¡€ MA ç­–ç•¥ | 3 | "ç”Ÿæˆå‡çº¿ç­–ç•¥ï¼ŒçŸ­æœŸ5å¤©é•¿æœŸ20å¤©" |
| ä¿å®ˆ/æ¿€è¿›å˜ä½“ | 2 | "ä¿å®ˆç­–ç•¥ï¼Œä»“ä½10%" / "æ¿€è¿›ç­–ç•¥ï¼Œä»“ä½30%" |
| é•¿æœŸ/çŸ­æœŸ | 2 | "50å¤©å’Œ200å¤©å‡çº¿" / "2å¤©å’Œ5å¤©å‡çº¿" |
| æ¨¡ç³Š/è¾¹ç•Œæƒ…å†µ | 3 | "å¸®æˆ‘åšä¸€ä¸ªè¶‹åŠ¿ç­–ç•¥" / "æœ€å°çª—å£1å¤©å’Œ2å¤©" |
| å¤šå‚æ•°ç»„åˆ | 2 | "çŸ­æœŸ5å¤©ã€é•¿æœŸ15å¤©ã€ä»“ä½20%" |
| è´Ÿå‘/å¼‚å¸¸æƒ…å†µ | 3 | "çŸ­çº¿æ¯”é•¿çº¿é•¿" / "200%ä»“ä½" / "æ€»æ˜¯ç›ˆåˆ©çš„ç­–ç•¥" |
| ä¸­è‹±æ–‡æ··åˆ | 2 | "Create MA strategy with short=7, long=21" |
| å¤æ‚éœ€æ±‚ | 3 | "é€‚åˆAè‚¡T+1çš„ç­–ç•¥" / "æ³¢æ®µæ“ä½œçª—å£15å’Œ45å¤©" |

**æµ‹è¯•ç”¨ä¾‹ç»“æ„**:
```python
{
    "id": "AG-001",
    "category": "moving_average",
    "prompt": "ç”Ÿæˆå‡çº¿ç­–ç•¥ï¼ŒçŸ­æœŸ5å¤©é•¿æœŸ20å¤©",
    "expected_type": "moving_average",
    "expected_params": {
        "short_window": {"value": 5, "constraint": "< long_window"},
        "long_window": {"value": 20, "constraint": "> short_window"},
    },
    "quality_checks": [
        "short_window < long_window",
        "short_window >= 1",
        "long_window >= 2",
    ],
}
```

#### KB Q&A æµ‹è¯•é›†
**æ–‡ä»¶**: [backend/benchmarks/kb_qa_test_set.py](../../backend/benchmarks/kb_qa_test_set.py)

**è§„æ¨¡**: 50 ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼ˆ20 è¯¦ç»† + 30 æ¡†æ¶ï¼‰

**è¦†ç›–èŒƒå›´**:
| ç±»åˆ« | ç”¨ä¾‹æ•° | ç¤ºä¾‹æŸ¥è¯¢ |
|-----|--------|---------|
| é£é™©ç®¡ç† | 3 | "å¦‚ä½•é™ä½å›æ’¤" / "stop lossè®¾ç½®å¤šå°‘" |
| æ€§èƒ½æŒ‡æ ‡ | 3 | "å¦‚ä½•æé«˜å¤æ™®æ¯”ç‡" / "æœ€å¤§å›æ’¤è®¡ç®—" |
| ç­–ç•¥å¼€å‘ | 3 | "å‡çº¿ç­–ç•¥ä¼˜åŒ–" / "å›æµ‹é™·é˜±" |
| å¸‚åœºå¾®è§‚ç»“æ„ | 2 | "ä¹°å–ä»·å·®å½±å“" / "å¸‚åœºå†²å‡»æˆæœ¬" |
| Aè‚¡ç‰¹æœ‰è§„åˆ™ | 2 | "T+1é™åˆ¶" / "æ¶¨è·Œåœæ¿å½±å“" |
| æŠ€æœ¯æŒ‡æ ‡ | 3 | "RSIè§£è¯»" / "å¸ƒæ—å¸¦ç­–ç•¥" / "MACDäº¤å‰" |
| ç»„åˆç®¡ç† | 3 | "åˆ†æ•£åŒ–æ”¶ç›Š" / "å†å¹³è¡¡é¢‘ç‡" |
| å…¶ä»– | 31 | å¸‚åœºè¡Œä¸ºã€ç»Ÿè®¡ã€äº¤æ˜“æˆæœ¬ç­‰ |

**æµ‹è¯•ç”¨ä¾‹ç»“æ„**:
```python
{
    "id": "KB-001",
    "category": "risk_management",
    "query": "å¦‚ä½•é™ä½å›æ’¤",
    "relevant_docs": [
        {
            "content": "To reduce drawdown, use stop-loss at 2%...",
            "relevance": "high",
        },
        ...
    ],
    "irrelevant_docs": [...],
    "quality_thresholds": {
        "recall@3": 0.67,  # è‡³å°‘2/3ç›¸å…³æ–‡æ¡£åœ¨top-3
        "top1_relevance": ["high", "medium"],
    },
}
```

### 2.2 Benchmark è¿è¡Œè„šæœ¬

#### Agent Benchmark Runner
**æ–‡ä»¶**: [backend/benchmarks/run_agent_benchmark.py](../../backend/benchmarks/run_agent_benchmark.py)

**çŠ¶æ€**: âœ… å®Œæˆå¹¶æµ‹è¯•é€šè¿‡

**åŠŸèƒ½**:
- è‡ªåŠ¨ç”Ÿæˆç­–ç•¥å¹¶è¯„ä¼°å‚æ•°æ­£ç¡®æ€§
- æ£€æŸ¥é€»è¾‘çº¦æŸï¼ˆå¦‚ short < longï¼‰
- æ”¯æŒå­é›†æµ‹è¯•å’Œåˆ†ç±»è¿‡æ»¤
- è¾“å‡ºè¯¦ç»† JSON ç»“æœ

**éªŒè¯ç»“æœ**:
```
è¿è¡Œ 3 ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼š
- AG-001: ç”Ÿæˆå‡çº¿ç­–ç•¥ï¼ŒçŸ­æœŸ5å¤©é•¿æœŸ20å¤© â†’ PASS (10 checks)
- AG-002: åˆ›å»ºå¿«é€Ÿå‡çº¿ç­–ç•¥ï¼Œ3å¤©å’Œ10å¤© â†’ PASS (9 checks)
- AG-003: Build MA strategy short=8 long=21 â†’ PASS (6 checks)

é€šè¿‡ç‡: 100% (3/3)
```

**ä½¿ç”¨æ–¹å¼**:
```bash
# è¿è¡Œå…¨éƒ¨æµ‹è¯•
python -m benchmarks.run_agent_benchmark

# è¿è¡Œå­é›†
python -m benchmarks.run_agent_benchmark --subset 5

# æŒ‰ç±»åˆ«è¿‡æ»¤
python -m benchmarks.run_agent_benchmark --category moving_average
```

#### KB Benchmark Runner
**çŠ¶æ€**: ğŸš§ å»¶åï¼ˆå·²åˆ›å»ºæµ‹è¯•é›†ï¼Œrunner å®ç°å¾… P2ï¼‰

**åŸå› **: Agent benchmark æ›´å…³é”®ï¼ŒKB æµ‹è¯•é›†å·²å‡†å¤‡å¥½ï¼Œrunner å¯åç»­è¿­ä»£

---

## 3. è´¨é‡æ ‡å‡†ä¸é˜ˆå€¼

### Agent ç”Ÿæˆè´¨é‡æ ‡å‡†
| ç»´åº¦ | æ ‡å‡† | å½“å‰è¡¨ç° |
|-----|------|---------|
| ç±»å‹æ­£ç¡®æ€§ | ç”Ÿæˆç±»å‹ç¬¦åˆ prompt | 100% (3/3) |
| å‚æ•°å®Œæ•´æ€§ | å¿…è¦å‚æ•°å…¨éƒ¨å­˜åœ¨ | 100% (3/3) |
| å‚æ•°å‡†ç¡®æ€§ | å‚æ•°å€¼ç¬¦åˆ promptï¼ˆå«å®¹å·®ï¼‰ | 100% (3/3) |
| é€»è¾‘æœ‰æ•ˆæ€§ | å‚æ•°å…³ç³»ç¬¦åˆä¸šåŠ¡é€»è¾‘ | 100% (3/3) |
| è¾¹ç•Œåˆè§„æ€§ | å‚æ•°åœ¨åˆç†èŒƒå›´å†… | 100% (3/3) |

### KB æ£€ç´¢è´¨é‡æ ‡å‡†ï¼ˆå·²å®šä¹‰ï¼Œå¾…æµ‹è¯•ï¼‰
| ç»´åº¦ | ç›®æ ‡é˜ˆå€¼ | æµ‹è¯•æ–¹æ³• |
|-----|---------|---------|
| Recall@3 | â‰¥ 80% | è‡³å°‘2/3ç›¸å…³æ–‡æ¡£åœ¨top-3ä¸­ |
| Top-1 ç›¸å…³æ€§ | â‰¥ 85% | ç¬¬ä¸€ç»“æœä¸ºhigh/mediumç›¸å…³æ€§ |
| æ’åºè´¨é‡ | å®šæ€§ | é«˜ç›¸å…³æ–‡æ¡£æ’åºé«˜äºéƒ¨åˆ†ç›¸å…³ |
| ç½®ä¿¡åº¦å‡†ç¡®æ€§ | å®šæ€§ | é«˜ç½®ä¿¡åº¦ç»“æœå®é™…ç›¸å…³ |

---

## 4. åŸºç¡€è®¾æ–½æ–‡æ¡£

**æ–‡ä»¶**: [backend/benchmarks/README.md](../../backend/benchmarks/README.md)

**å†…å®¹**:
- Benchmark æ¶æ„è¯´æ˜
- æµ‹è¯•é›†è§„æ ¼ä¸è¦†ç›–èŒƒå›´
- è¿è¡Œè„šæœ¬ä½¿ç”¨æŒ‡å—
- è´¨é‡æ ‡å‡†ä¸é˜ˆå€¼å®šä¹‰
- CI/CD é›†æˆå»ºè®®
- ä¸‹ä¸€æ­¥è®¡åˆ’

---

## 5. ä¸ P0 çš„å…³ç³»

| ç»´åº¦ | P0ï¼ˆè´¨é‡æµ‹è¯•ï¼‰ | P1ï¼ˆBenchmark åŸºç¡€è®¾æ–½ï¼‰ |
|-----|--------------|----------------------|
| ç›®çš„ | éªŒè¯å½“å‰åŠŸèƒ½è´¨é‡ | å»ºç«‹é•¿æœŸç›‘æ§èƒ½åŠ› |
| è¿è¡Œæ—¶æœº | æ¯æ¬¡ä»£ç æäº¤ï¼ˆCIï¼‰ | æ¯æ¬¡å‘ç‰ˆ / å®šæœŸï¼ˆå‘¨/æœˆï¼‰ |
| è¦†ç›–èŒƒå›´ | 4 ä¸ªæ ¸å¿ƒè´¨é‡æµ‹è¯• | 20+ Agent cases, 50+ KB cases |
| è¾“å‡º | é€šè¿‡/å¤±è´¥ | è¯¦ç»†è¯„åˆ† + è¶‹åŠ¿è¿½è¸ª |
| å·¥å…· | pytestï¼ˆå•å…ƒæµ‹è¯•ï¼‰ | ä¸“ç”¨ benchmark runner |

**ååŒä½œç”¨**:
- P0 ç¡®ä¿æ¯æ¬¡æ”¹åŠ¨ä¸ç ´åè´¨é‡
- P1 è¿½è¸ªé•¿æœŸè´¨é‡è¶‹åŠ¿ï¼Œå‘ç°é€€åŒ–
- P0 æ˜¯è´¨é‡é—¨ç¦ï¼ŒP1 æ˜¯è´¨é‡åº¦é‡

---

## 6. ä¸‹ä¸€æ­¥è¡ŒåŠ¨ï¼ˆP2ï¼‰

### 6.1 å®Œæˆ KB Benchmark Runner
- å®ç° KB æ£€ç´¢è¯„ä¼°é€»è¾‘
- è®¡ç®— recall@k å’Œæ’åºæŒ‡æ ‡
- è¿è¡ŒåŸºçº¿æµ‹è¯•å¹¶è®°å½•ç»“æœ

### 6.2 å»ºç«‹åŸºçº¿ä¸ç›‘æ§
- è¿è¡Œå®Œæ•´ Agent benchmarkï¼ˆ20 casesï¼‰
- è¿è¡Œå®Œæ•´ KB benchmarkï¼ˆ50 casesï¼‰
- è®°å½•åŸºçº¿æŒ‡æ ‡å¹¶è®¾ç½®å‘Šè­¦é˜ˆå€¼

### 6.3 é›†æˆåˆ°å‘ç‰ˆæµç¨‹
- åœ¨å‘ç‰ˆå‰å¼ºåˆ¶è¿è¡Œ benchmark
- å¯¹æ¯”åŸºçº¿ï¼Œæ£€æµ‹é€€åŒ–
- è®°å½•å†å²è¶‹åŠ¿ï¼ˆæœˆåº¦æŠ¥å‘Šï¼‰

### 6.4 æ‰©å±•æµ‹è¯•é›†
- Agent: æ·»åŠ  RSIã€Bollinger Bands ç­–ç•¥æµ‹è¯•
- KB: ä»çœŸå®ç”¨æˆ·é—®é¢˜ä¸­è¡¥å……æµ‹è¯•ç”¨ä¾‹
- ç«¯åˆ°ç«¯: è®¾è®¡å®Œæ•´ç”¨æˆ·å·¥ä½œæµæµ‹è¯•

---

## 7. è¯æ®æ–‡ä»¶

| æ–‡ä»¶ | è·¯å¾„ | ç”¨é€” |
|-----|------|------|
| Agentæµ‹è¯•é›† | `backend/benchmarks/agent_prompt_test_set.py` | 20ä¸ªpromptæµ‹è¯•ç”¨ä¾‹ |
| KBæµ‹è¯•é›† | `backend/benchmarks/kb_qa_test_set.py` | 50ä¸ªQ&Aæµ‹è¯•ç”¨ä¾‹ |
| Agent Runner | `backend/benchmarks/run_agent_benchmark.py` | è‡ªåŠ¨åŒ–è¯„ä¼°è„šæœ¬ |
| Benchmark README | `backend/benchmarks/README.md` | æ¶æ„ä¸ä½¿ç”¨æ–‡æ¡£ |
| éªŒè¯ç»“æœ | `.runtime/benchmarks/agent_benchmark_20260210_150947.json` | 3ç”¨ä¾‹100%é€šè¿‡ |

---

## 8. æ€»ç»“

### å·²å®Œæˆ âœ…
- [x] åˆ›å»º Agent prompt æµ‹è¯•é›†ï¼ˆ20 casesï¼‰
- [x] åˆ›å»º KB Q&A æµ‹è¯•é›†ï¼ˆ50 casesï¼‰
- [x] å®ç° Agent benchmark runner
- [x] éªŒè¯ Agent runner æ­£ç¡®æ€§ï¼ˆ3/3 PASSï¼‰
- [x] ç¼–å†™ benchmark åŸºç¡€è®¾æ–½æ–‡æ¡£

### å¾…å®Œæˆï¼ˆP2ï¼‰
- [ ] å®ç° KB benchmark runner
- [ ] è¿è¡Œå®Œæ•´åŸºçº¿æµ‹è¯•
- [ ] å»ºç«‹å†å²è¶‹åŠ¿è¿½è¸ª
- [ ] é›†æˆåˆ° CI/CD æµç¨‹

### å…³é”®ä»·å€¼

1. **å¯é‡å¤æ€§**: æ ‡å‡†åŒ–æµ‹è¯•é›†ç¡®ä¿æ¯æ¬¡è¯„ä¼°ä¸€è‡´
2. **å¯è¿½è¸ªæ€§**: JSON è¾“å‡ºæ”¯æŒå†å²å¯¹æ¯”ä¸è¶‹åŠ¿åˆ†æ
3. **å¯æ‰©å±•æ€§**: æ¡†æ¶æ”¯æŒå¿«é€Ÿæ·»åŠ æ–°æµ‹è¯•ç”¨ä¾‹
4. **è‡ªåŠ¨åŒ–**: å‘½ä»¤è¡Œå·¥å…·æ”¯æŒ CI/CD é›†æˆ
5. **é€æ˜åº¦**: è¯¦ç»†ç»“æœå±•ç¤ºæ¯ä¸ªæ£€æŸ¥çš„é€šè¿‡/å¤±è´¥çŠ¶æ€

---

**æŠ¥å‘Šç»“æŸ**

ç›¸å…³æ–‡æ¡£ï¼š
- P0ä»»åŠ¡æ€»ç»“: [P0_AI_Quality_Tests_Summary.md](../../docs/QA/P0_AI_Quality_Tests_Summary.md)
- å®Œæ•´åˆ†æ: [AI_Features_Testing_Analysis_2026-02-10.md](../../docs/QA/AI_Features_Testing_Analysis_2026-02-10.md)
- Benchmark README: [backend/benchmarks/README.md](../../backend/benchmarks/README.md)
