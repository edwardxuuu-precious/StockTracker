# Goal#2: 投资组合管理 - 待办事项

## 📋 目标概述

**目标编号:** Goal#2
**目标名称:** 投资组合管理
**当前状态:** 🚧 进行中
**完成度:** 80%
**优先级:** 🔥 高 (核心功能)

---

## 🎯 核心待办事项

### 紧急且重要 🔥🔥🔥

#### TODO-2.1: 完成删除组合功能
**优先级:** P0 (最高)
**预计工时:** 2小时
**前置依赖:** 无

**任务描述:**
实现删除投资组合的完整功能,包括确认对话框和软删除逻辑。

**具体步骤:**
1. [ ] 创建删除确认对话框组件
   - 显示组合名称
   - 显示警告信息
   - 提供确认和取消按钮

2. [ ] 实现前端删除逻辑
   - 点击删除按钮弹出确认框
   - 确认后调用API
   - 成功后更新列表
   - 失败时显示错误

3. [ ] 测试删除功能
   - 测试正常删除
   - 测试取消操作
   - 测试API失败场景
   - 测试乐观更新回滚

**完成标准:**
```
✅ 点击删除显示确认框
✅ 确认框显示组合名称
✅ 点击确认调用API
✅ 删除成功列表刷新
✅ 删除失败显示错误
✅ 点击取消关闭对话框
```

**测试用例:**
```javascript
// 1. 正常删除
点击删除 → 确认 → API成功 → 列表移除组合

// 2. 取消删除
点击删除 → 取消 → 对话框关闭 → 列表不变

// 3. 删除失败
点击删除 → 确认 → API失败 → 显示错误提示
```

---

#### TODO-2.2: 优化表单验证
**优先级:** P0
**预计工时:** 3小时
**前置依赖:** 无

**任务描述:**
完善创建和编辑组合表单的验证逻辑,提供清晰的错误提示。

**具体步骤:**
1. [ ] 实现前端表单验证
   - 必填字段验证
   - 数据类型验证
   - 数值范围验证
   - 实时验证反馈

2. [ ] 优化错误提示
   - 字段级错误提示
   - 表单级错误汇总
   - 友好的错误文案
   - 错误消除机制

3. [ ] 添加验证规则
   ```javascript
   // 名称验证
   - 必填
   - 2-50字符
   - 不能重复
   - 不含特殊字符

   // 初始资金验证
   - 必填
   - 数值类型
   - 大于0
   - 最多2位小数

   // 描述验证
   - 可选
   - 最多200字符
   ```

4. [ ] 测试验证功能
   - 测试所有验证规则
   - 测试错误提示显示
   - 测试错误消除
   - 测试提交拦截

**完成标准:**
```
✅ 必填字段不填显示错误
✅ 数值格式错误显示提示
✅ 重名组合提示已存在
✅ 错误提示位置正确
✅ 修正错误后提示消除
✅ 有错误时禁止提交
```

---

### 重要不紧急 🔥🔥

#### TODO-2.3: 集成Zustand状态管理
**优先级:** P1
**预计工时:** 4小时
**前置依赖:** 无

**任务描述:**
使用Zustand管理投资组合的全局状态,实现乐观更新和错误回滚。

**具体步骤:**
1. [ ] 创建Portfolio Store
   ```javascript
   // stores/portfolioStore.js
   import create from 'zustand'

   const usePortfolioStore = create((set, get) => ({
     portfolios: [],
     loading: false,
     error: null,

     // Actions
     fetchPortfolios: async () => {},
     createPortfolio: async (data) => {},
     updatePortfolio: async (id, data) => {},
     deletePortfolio: async (id) => {},

     // 乐观更新
     optimisticUpdate: (id, data) => {},
     rollback: (snapshot) => {},
   }))
   ```

2. [ ] 实现乐观更新
   - 创建时立即添加到列表
   - 更新时立即修改数据
   - 删除时立即移除
   - API失败时回滚

3. [ ] 替换组件中的状态
   - PortfoliosPage使用store
   - CreateForm使用store
   - EditForm使用store
   - 移除本地useState

4. [ ] 测试状态管理
   - 测试乐观更新
   - 测试错误回滚
   - 测试多组件同步
   - 测试性能影响

**完成标准:**
```
✅ Store创建成功
✅ Actions正常工作
✅ 乐观更新流畅
✅ 失败正确回滚
✅ 多组件状态同步
✅ 无性能问题
```

**不做事项 (参考Stop_Doing.md):**
- ❌ 不使用Redux (过于复杂)
- ❌ 不使用Context (性能问题)
- ❌ 不手动管理loading状态 (store统一管理)

---

#### TODO-2.4: 优化用户界面
**优先级:** P1
**预计工时:** 3小时
**前置依赖:** TODO-2.1, TODO-2.2

**任务描述:**
改进投资组合列表和表单的用户体验,添加Loading状态和空状态。

**具体步骤:**
1. [ ] 添加Loading状态
   - 列表加载骨架屏
   - 按钮加载动画
   - 表单提交禁用
   - 操作反馈提示

2. [ ] 添加空状态
   - 无组合时显示引导
   - 搜索无结果提示
   - 错误状态页面
   - 友好的空状态图标

3. [ ] 优化交互
   - 表单自动聚焦
   - Enter提交表单
   - Esc关闭对话框
   - 快捷键支持

4. [ ] 优化视觉
   - 统一颜色方案
   - 一致的间距
   - 平滑的动画
   - 响应式布局

**完成标准:**
```
✅ Loading状态清晰
✅ 空状态友好
✅ 交互流畅自然
✅ 视觉统一美观
✅ 移动端适配
```

---

### 紧急不重要 🔥

#### TODO-2.5: 添加搜索和筛选
**优先级:** P2
**预计工时:** 2小时
**前置依赖:** TODO-2.3

**任务描述:**
实现投资组合的搜索和筛选功能,方便用户快速定位。

**具体步骤:**
1. [ ] 实现搜索功能
   - 搜索框组件
   - 按名称搜索
   - 实时搜索
   - 搜索结果高亮

2. [ ] 实现筛选功能
   - 按状态筛选(活跃/禁用)
   - 按创建时间排序
   - 按资金规模排序
   - 多条件组合

3. [ ] 测试搜索筛选
   - 测试搜索准确性
   - 测试筛选准确性
   - 测试性能
   - 测试用户体验

**完成标准:**
```
✅ 搜索功能正常
✅ 筛选功能正常
✅ 搜索实时响应
✅ 结果准确无误
```

**建议 (非必须):**
- 可以考虑添加高级搜索
- 可以保存搜索条件
- 但优先完成核心功能

---

### 不紧急不重要 (暂不实施)

#### 批量操作功能
**说明:** 批量删除、批量导出等功能暂不实施
**原因:**
- 不是核心必需功能
- 增加开发复杂度
- 用户需求不明确
**决策:** 等核心功能完成后,根据用户反馈决定是否实施

#### 组合模板功能
**说明:** 预设组合模板(如"价值投资组合")
**原因:**
- 需要领域专业知识
- 维护成本高
- 优先级低
**决策:** Phase 2可考虑

---

## 📅 时间规划

### 本周 (2026-02-06 ~ 2026-02-10)
**目标:** 完成所有P0任务

**周一 (02/06):**
- [x] 创建进度文档
- [ ] 开始TODO-2.1 删除功能

**周二 (02/07):**
- [ ] 完成TODO-2.1
- [ ] 开始TODO-2.2 表单验证

**周三 (02/08):**
- [ ] 完成TODO-2.2
- [ ] 开始TODO-2.3 Zustand集成

**周四 (02/09):**
- [ ] 完成TODO-2.3
- [ ] 开始TODO-2.4 UI优化

**周五 (02/10):**
- [ ] 完成TODO-2.4
- [ ] 整体测试和bug修复

**周末 (02/11-02/12):**
- [ ] 可选:TODO-2.5 搜索筛选
- [ ] 准备Goal#3 持仓管理

---

## ✅ 完成标准

### Goal#2完成标准
当以下所有条件满足时,Goal#2视为完成:

**功能完整性:**
- ✅ 创建组合功能完整可用
- ✅ 编辑组合功能完整可用
- ✅ 删除组合功能完整可用
- ✅ 查询组合列表功能正常
- ✅ 表单验证完善

**用户体验:**
- ✅ Loading状态清晰
- ✅ 错误提示友好
- ✅ 操作流畅自然
- ✅ 空状态友好
- ✅ 移动端适配

**代码质量:**
- ✅ 状态管理规范
- ✅ 错误处理完善
- ✅ 代码结构清晰
- ✅ 注释完整

**测试验证:**
- ✅ 所有功能测试通过
- ✅ 边界条件测试通过
- ✅ 错误场景测试通过
- ✅ 性能测试通过

---

## 🚫 不做事项清单

参考 [Stop_Doing.md](./Stop_Doing.md) 中的约束条件:

### 技术选择
- ❌ 不使用Redux (过于复杂,Zustand足够)
- ❌ 不使用Context传递全局状态 (性能问题)
- ❌ 不手动管理每个API的loading状态 (Store统一)

### 功能边界
- ❌ 不实现批量操作 (非核心功能)
- ❌ 不实现组合模板 (Phase 2考虑)
- ❌ 不实现高级权限 (当前单用户)
- ❌ 不实现组合分享 (非必需)

### 代码实践
- ❌ 不过度优化 (优先完成功能)
- ❌ 不过度抽象 (保持简单)
- ❌ 不预设未来需求 (YAGNI原则)

### 时间管理
- ❌ 不陷入完美主义 (够用即可)
- ❌ 不同时开发多个功能 (专注)
- ❌ 不跳过测试 (质量优先)

---

## 📝 备注

### 风险提示
- ⚠️ Zustand集成可能影响现有代码
- ⚠️ 表单验证需要考虑国际化
- ⚠️ 删除功能需要考虑级联删除

### 协作提示
- 💡 完成P0任务后再考虑P1
- 💡 遇到问题及时记录到Stop_Doing
- 💡 每完成一个TODO及时更新进度

### 质量要求
- 🎯 每个功能都要有测试
- 🎯 每个功能都要有错误处理
- 🎯 每个功能都要考虑用户体验

---

**最后更新:** 2026-02-06
**下次更新:** 2026-02-08
**负责人:** Claude
